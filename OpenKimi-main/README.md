<div align="center">

<h1> OpenKimi âœ¨ </h1>

_è®©LLMçªç ´ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶çš„å®‡å®™é£èˆ¹_ï¼Œé¡ºä¾¿ä¸€æï¼Œæˆ‘ä»¬æ²¡æœ‰è‚¡æƒçº çº· :)

[![License](https://img.shields.io/badge/License-MIT%20License-blue.svg)](https://opensource.org/licenses/MIT%20License)
[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![Stars](https://img.shields.io/github/stars/Chieko-Seren/openkimi.svg?style=social&label=Star)](https://github.com/yourusername/openkimi)
[![Issues](https://img.shields.io/github/issues/Chieko-Seren/openkimi.svg)](https://github.com/yourusername/openkimi/issues)


  <img src="https://i.postimg.cc/6qdQbvPf/open-kimi.png">
</div>

[åœ¨çº¿ Demo](https://chieko-seren.github.io/OpenKimi/) | [QQ ç¾¤ç»„](https://qm.qq.com/q/65zMQ7fMrY) | [æŸ¥çœ‹å¼€å‘æ–‡æ¡£](https://github.com/Chieko-Seren/OpenKimi/blob/main/docs/index.md) | [æŠ¥å‘Šå®‰å…¨æ¼æ´](https://github.com/Chieko-Seren/OpenKimi/security)

## ğŸŒŸ é¡¹ç›®ä»‹ç»
OpenKimi æ˜¯é¦–ä¸ªé¢å‘å¼€å‘è€…çš„**æ— é™ä¸Šä¸‹æ–‡LLMæ”¯æŒæ¡†æ¶**ï¼Œæ—¨åœ¨æ‰“ç ´ä¼ ç»Ÿå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ã€‚é€šè¿‡é©å‘½æ€§çš„ä¸Šä¸‹æ–‡ç®¡ç†ç®—æ³•å’Œé«˜æ•ˆçš„å†…å­˜ä¼˜åŒ–æŠ€æœ¯ï¼ŒOpenKimi ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œè®©æ¨¡å‹èƒ½å¤Ÿå¤„ç†è¶…å¤§è§„æ¨¡æ–‡æœ¬æ•°æ®å¹¶è¿›è¡Œæ·±åº¦è¯­ä¹‰æ¨ç†ã€‚æˆ‘ä»¬å®ç°äº†ï¼š

- âœ… **ç™¾ä¸‡çº§Tokenæ”¯æŒ**ï¼šè½»æ¾å¤„ç†è¶…é•¿æ–‡æœ¬ï¼Œæ— è®ºæ˜¯å°è¯´ã€è®ºæ–‡è¿˜æ˜¯ä»£ç åº“ã€‚
- âœ… **é›¶ç²¾åº¦æŸå¤±çš„å†…å­˜å‹ç¼©**ï¼šåœ¨ä¿æŒæ¨¡å‹æ¨ç†è´¨é‡çš„åŒæ—¶å¤§å¹…é™ä½å†…å­˜å ç”¨ã€‚
- âœ… **è·¨æ¨¡å‹çš„ç»Ÿä¸€æ¥å£**ï¼šæ”¯æŒä¸»æµLLMï¼ˆå¦‚ LLaMAã€GPT ç­‰ï¼‰ï¼Œæ— éœ€ä¸ºä¸åŒæ¨¡å‹è°ƒæ•´ä»£ç ã€‚
- âœ… **å®æ—¶åŠ¨æ€ä¸Šä¸‹æ–‡ä¼˜åŒ–**ï¼šæ ¹æ®è¾“å…¥åŠ¨æ€è°ƒæ•´ä¸Šä¸‹æ–‡çª—å£ï¼Œç¡®ä¿æ€§èƒ½ä¸æ•ˆç‡çš„å®Œç¾å¹³è¡¡ã€‚

OpenKimi çš„ç›®æ ‡æ˜¯çªç ´ä¼ ç»Ÿ LLM çš„"ä¸Šä¸‹æ–‡ç›‘ç‹±"ï¼Œè®©æ¨¡å‹èƒ½å¤ŸçœŸæ­£ç†è§£å®Œæ•´çš„äººç±»çŸ¥è¯†ä½“ç³»ï¼Œä»å•ä¸€å¯¹è¯åˆ°æ•´ä¸ªçŸ¥è¯†å›¾è°±ï¼ŒåŠ©åŠ›å¼€å‘è€…æ„å»ºæ›´æ™ºèƒ½ã€æ›´å…·æ´å¯ŸåŠ›çš„åº”ç”¨ã€‚

## ğŸŒ ä¸ºä»€ä¹ˆé€‰æ‹© OpenKimiï¼Ÿ
- **æ— é™å¯èƒ½**ï¼šæ— è®ºæ˜¯åˆ†ææ•´éƒ¨ã€Šæˆ˜äº‰ä¸å’Œå¹³ã€‹ã€ç†è§£å¤æ‚çš„æŠ€æœ¯æ–‡æ¡£ï¼Œè¿˜æ˜¯æ¨ç†è·¨é¢†åŸŸçš„çŸ¥è¯†ï¼ŒOpenKimi éƒ½èƒ½èƒœä»»ã€‚
- **å¼€å‘è€…å‹å¥½**ï¼šç®€æ´çš„ API è®¾è®¡ï¼Œå‡ è¡Œä»£ç å³å¯ä¸Šæ‰‹ã€‚
- **å¼€æºç²¾ç¥**ï¼šå®Œå…¨å¼€æºï¼Œç¤¾åŒºé©±åŠ¨ï¼Œæ¬¢è¿æ¯ä¸€ä½æ¢ç´¢è€…çš„è´¡çŒ®ã€‚

## ğŸš€ å¿«é€Ÿä½“éªŒ

### å®‰è£…
ç¡®ä¿ä½ æœ‰ Python 3.8+ ç¯å¢ƒï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… OpenKimiï¼š

```bash
pip install openkimi
```

### ç¤ºä¾‹ä»£ç 
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ OpenKimi åŠ è½½ã€Šä¸‰ä½“ã€‹å…¨æ–‡å¹¶è¿›è¡Œæ·±åº¦åˆ†æï¼š

```python
from openkimi import KimiEngine

# åˆå§‹åŒ–ä»»æ„å¤§è¯­è¨€æ¨¡å‹ï¼ˆæ›¿æ¢ä¸ºä½ çš„æ¨¡å‹è·¯å¾„ï¼‰
engine = KimiEngine(llm="your-model-path")

# åŠ è½½ã€Šä¸‰ä½“ã€‹å…¨æ–‡æœ¬ï¼ˆçº¦30ä¸‡å­—ï¼‰
with open("three_body.txt", "r", encoding="utf-8") as f:
    engine.ingest(f.read())

# è¿›è¡Œæ·±åº¦è¯­ä¹‰æ¨ç†
response = engine.chat("è¯·åˆ†æç¬¬äºŒéƒ¨ã€Šé»‘æš—æ£®æ—ã€‹çš„æ ¸å¿ƒéšå–»")
print(response)
```


## ğŸ› ï¸ ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindowsã€Linux æˆ– macOS
- **Python ç‰ˆæœ¬**ï¼š3.8 æˆ–æ›´é«˜
- **å†…å­˜**ï¼šå»ºè®® 16GB+ï¼ˆæ ¹æ®æ¨¡å‹å’Œè¾“å…¥è§„æ¨¡è€Œå®šï¼‰
- **ä¾èµ–**ï¼šè¯¦è§ `requirements.txt`

## ğŸ“– ä½¿ç”¨æŒ‡å—
1. **å®‰è£…ä¾èµ–**ï¼š
   ```bash
   pip install -r requirements.txt
   ```
2. **é…ç½®æ¨¡å‹**ï¼šå°†ä½ çš„ LLM æ¨¡å‹è·¯å¾„ä¼ å…¥ `KimiEngine`ã€‚
3. **åŠ è½½æ•°æ®**ï¼šä½¿ç”¨ `ingest()` æ–¹æ³•åŠ è½½ä»»æ„é•¿åº¦çš„æ–‡æœ¬ã€‚
4. **å¼€å§‹æ¨ç†**ï¼šè°ƒç”¨ `chat()` æˆ–å…¶ä»–æ¥å£è·å–ç»“æœã€‚

## ğŸŒ  åº”ç”¨åœºæ™¯
- **æ–‡å­¦åˆ†æ**ï¼šç†è§£é•¿ç¯‡å°è¯´çš„æƒ…èŠ‚ã€ä¸»é¢˜å’Œéšå–»ã€‚
- **æŠ€æœ¯æ–‡æ¡£å¤„ç†**ï¼šå¿«é€Ÿæå–ä»£ç åº“æˆ–è®ºæ–‡çš„å…³é”®ä¿¡æ¯ã€‚
- **çŸ¥è¯†ç®¡ç†**ï¼šæ„å»ºä¸ªäººçŸ¥è¯†åº“ï¼Œå›ç­”è·¨æ–‡æ¡£çš„é—®é¢˜ã€‚
- **æ•™è‚²ä¸ç ”ç©¶**ï¼šè¾…åŠ©å­¦æœ¯ç ”ç©¶ï¼Œå¤„ç†è¶…å¤§è§„æ¨¡æ•°æ®é›†ã€‚

## ğŸ¤ å‚ä¸è´¡çŒ®
OpenKimi æ˜¯ç¤¾åŒºé©±åŠ¨çš„å¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬æ‹¥æŠ±æ˜Ÿè¾°å¤§æµ·ï¼ŒæœŸå¾…æ‚¨çš„åŠ å…¥ï¼ä»¥ä¸‹æ˜¯å‚ä¸æ–¹å¼ï¼š

1. **æäº¤ Issue**ï¼šè®¨è®ºæ–°åŠŸèƒ½ã€æŠ¥å‘Š Bug æˆ–æå‡ºä¼˜åŒ–å»ºè®®ã€‚
2. **Fork ä»“åº“**ï¼šå…‹éš†é¡¹ç›®åˆ°æœ¬åœ°è¿›è¡Œå¼€å‘ã€‚
3. **æäº¤ Pull Request**ï¼šå¼€å‘å®Œæˆåå…³è”ç›¸å…³ Issueï¼Œæäº¤ä»£ç ã€‚
4. **ä»£ç å®¡æŸ¥**ï¼šé€šè¿‡ CI æµ‹è¯•åï¼Œç­‰å¾… maintainers å®¡æ ¸åˆå¹¶ã€‚

## ğŸŒŸ è‡´è°¢
æ„Ÿè°¢æ‰€æœ‰ä¸º OpenKimi åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ã€æµ‹è¯•è€…å’Œç”¨æˆ·ï¼

## ğŸ“¬ è”ç³»æˆ‘ä»¬
- **GitHub Issues**ï¼š https://github.com/Chieko-Seren/OpenKimi/issues
- **é‚®ç®±**ï¼šchieko.seren@icloud.com

## ğŸ” é¡¹ç›®ç»“æ„

```
openkimi/
â”œâ”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½å®ç°
â”‚   â”œâ”€â”€ engine.py      # ä¸»å¼•æ“
â”‚   â”œâ”€â”€ processor.py   # æ–‡æœ¬å¤„ç†å™¨
â”‚   â”œâ”€â”€ rag.py         # RAGç®¡ç†
â”‚   â””â”€â”€ framework.py   # æ¡†æ¶ç”Ÿæˆ
â”œâ”€â”€ utils/             # å·¥å…·ç±»
â”‚   â””â”€â”€ llm_interface.py # LLMæ¥å£
â””â”€â”€ __init__.py        # åŒ…åˆå§‹åŒ–
```

## ğŸ§  æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

OpenKimi é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°æ— é™ä¸Šä¸‹æ–‡å¤„ç†ï¼š

### æ–‡æœ¬å¤„ç†å’Œä¿¡æ¯ç†µè®¡ç®—
- **åˆ†å—**: å°†é•¿æ–‡æœ¬åˆ‡åˆ†ä¸ºå¯ç®¡ç†çš„å¤§å° (`batch_size`)ã€‚
- **ä¿¡æ¯ç†µè¯„ä¼°**: ä½¿ç”¨è¯é¢‘è®¡ç®—æ¯ä¸ªå—çš„ä¿¡æ¯ç†µï¼Œè¯„ä¼°å…¶ä¿¡æ¯å¯†åº¦ã€‚
- **åˆ†ç±»**: ä½äºé˜ˆå€¼ (`entropy_threshold`) çš„å—è¢«è§†ä¸ºä¿¡æ¯å¯†åº¦è¾ƒä½ã€‚

```python
from openkimi.core import TextProcessor

processor = TextProcessor(batch_size=512)
batches = processor.split_into_batches(long_text)
useful, less_useful = processor.classify_by_entropy(batches, threshold=3.0)
```

### RAG ç®¡ç† (å‘é‡æ£€ç´¢)
- **å­˜å‚¨**: ä½ä¿¡æ¯ç†µæ–‡æœ¬å—é€šè¿‡ LLM è¿›è¡Œæ‘˜è¦ï¼Œæ‘˜è¦å’ŒåŸæ–‡ä¸€åŒå­˜å‚¨ã€‚æ‘˜è¦æ–‡æœ¬è¢«è½¬æ¢ä¸ºå‘é‡ï¼ˆä½¿ç”¨ `sentence-transformers`ï¼‰å¹¶ç´¢å¼•ã€‚
- **æ£€ç´¢**: å½“éœ€è¦é¢å¤–ä¸Šä¸‹æ–‡æ—¶ï¼Œç”¨æˆ·æŸ¥è¯¢è¢«è½¬æ¢ä¸ºå‘é‡ï¼Œé€šè¿‡è®¡ç®—ä¸å­˜å‚¨çš„æ‘˜è¦å‘é‡ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦æ¥æ£€ç´¢æœ€ç›¸å…³çš„åŸæ–‡å— (`top_k`)ã€‚
- **é«˜æ•ˆå‘é‡æ£€ç´¢**: ä½¿ç”¨FAISSï¼ˆFacebook AIç›¸ä¼¼æ€§æœç´¢ï¼‰è¿›è¡Œé«˜æ•ˆå‘é‡ç´¢å¼•å’Œæ£€ç´¢ï¼Œæ˜¾è‘—æå‡å¤§è§„æ¨¡å‘é‡é›†åˆçš„æ£€ç´¢é€Ÿåº¦ã€‚

```python
from openkimi.core import RAGManager
from openkimi.utils.llm_interface import get_llm_interface

llm = get_llm_interface({"type": "dummy"})
# å¯ç”¨FAISSåŠ é€Ÿå‘é‡æ£€ç´¢
rag = RAGManager(llm, embedding_model_name='all-MiniLM-L6-v2', use_faiss=True) 
summaries = rag.batch_store(less_useful_texts)
relevant_texts = rag.retrieve("ç›¸å…³æŸ¥è¯¢", top_k=3)
```

### é€’å½’ RAG å‹ç¼©
- **ä¸Šä¸‹æ–‡è¶…é™å¤„ç†**: åœ¨è°ƒç”¨ LLMï¼ˆç”¨äºæ‘˜è¦ã€æ¡†æ¶ç”Ÿæˆã€è§£å†³æ–¹æ¡ˆç”Ÿæˆç­‰ï¼‰ä¹‹å‰ï¼Œå¦‚æœæ„é€ çš„ Prompt è¶…è¿‡æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ (`max_prompt_tokens`)ï¼ŒOpenKimi ä¼šè‡ªåŠ¨è§¦å‘é€’å½’ RAG å‹ç¼©ã€‚
- **å‹ç¼©è¿‡ç¨‹**: è¶…é•¿çš„æ–‡æœ¬ä¼šè¢«åˆ†å—ã€è®¡ç®—ä¿¡æ¯ç†µï¼Œä½ä¿¡æ¯ç†µéƒ¨åˆ†è¢«ä¸´æ—¶ RAG å­˜å‚¨ï¼ˆç”Ÿæˆæ‘˜è¦å¹¶å‘é‡åŒ–ï¼‰ï¼Œåªä¿ç•™é«˜ä¿¡æ¯ç†µéƒ¨åˆ†å’Œä½ä¿¡æ¯ç†µéƒ¨åˆ†çš„æ‘˜è¦ï¼Œå½¢æˆå‹ç¼©åçš„æ–‡æœ¬ã€‚æ­¤è¿‡ç¨‹å¯é€’å½’è¿›è¡Œï¼Œç›´è‡³æ–‡æœ¬é•¿åº¦ç¬¦åˆè¦æ±‚ã€‚

### æ¡†æ¶ç”Ÿæˆ & MCP
- **æ¡†æ¶ç”Ÿæˆ**: å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºæ­¥éª¤ï¼Œç¡®ä¿è§£å†³æ–¹æ¡ˆçš„é€»è¾‘æ€§ã€‚
- **MCP (Mixture of Context Prompters)**: ï¼ˆå¯é€‰ï¼Œé€šè¿‡ `mcp_candidates` é…ç½®ï¼‰ä¸ºåŒä¸€ä¸ªé—®é¢˜ç”Ÿæˆå¤šä¸ªå€™é€‰è§£å†³æ–¹æ¡ˆï¼ˆå¯èƒ½åŸºäºä¸Šä¸‹æ–‡çš„ä¸åŒä¾§é‡æˆ–éšæœºæ€§ï¼‰ï¼Œç„¶åé€šè¿‡æœ€ç»ˆçš„ LLM è°ƒç”¨å°†è¿™äº›å€™é€‰æ–¹æ¡ˆç»¼åˆæˆä¸€ä¸ªæ›´å…¨é¢ã€æ›´é²æ£’çš„æœ€ç»ˆç­”æ¡ˆã€‚

```python
from openkimi.core import FrameworkGenerator

framework_gen = FrameworkGenerator(llm)
solution_framework = framework_gen.generate_framework("å¤æ‚é—®é¢˜", context=relevant_history)
# ä½¿ç”¨ MCP (å‡è®¾ mcp_candidates > 1)
final_solution = framework_gen.generate_solution_mcp(
    "å¤æ‚é—®é¢˜", 
    solution_framework, 
    useful_context=relevant_history, 
    rag_context=retrieved_rag_texts, 
    num_candidates=3
)
```

### å¯æ’æ‹” LLM æ¥å£
- æ”¯æŒ `dummy` (ç”¨äºæµ‹è¯•), `local` (ä½¿ç”¨ Hugging Face `transformers` åŠ è½½æœ¬åœ°æ¨¡å‹) å’Œ `api` (å…¼å®¹ OpenAI Chat Completion API) ç±»å‹ã€‚
- é€šè¿‡é…ç½®æ–‡ä»¶æˆ–åˆå§‹åŒ–å‚æ•°è½»æ¾åˆ‡æ¢ã€‚

## âš™ï¸ é…ç½®é€‰é¡¹

é€šè¿‡ JSON é…ç½®æ–‡ä»¶ (`config.json`) æˆ– `KimiEngine` åˆå§‹åŒ–å‚æ•°è¿›è¡Œé…ç½®ï¼š

- **`llm`**: 
    - `type`: "dummy", "local", "api"
    - `model_path`: (local) æ¨¡å‹è·¯å¾„æˆ– HF Hub åç§°
    - `device`: (local) "auto", "cpu", "cuda", "mps"
    - `api_key`: (api) API å¯†é’¥ (æˆ–ä» `OPENAI_API_KEY` ç¯å¢ƒå˜é‡è¯»å–)
    - `api_url`: (api) API ç«¯ç‚¹ (æˆ–ä» `OPENAI_API_BASE` ç¯å¢ƒå˜é‡è¯»å–)
    - `model_name`: (api) ä½¿ç”¨çš„æ¨¡å‹åç§° (e.g., "gpt-4")
    - `context_length`: (api/local) æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦ (Token æ•°)
- **`processor`**: 
    - `batch_size`: æ–‡æœ¬åˆ†å—å¤§å°
    - `entropy_threshold`: ä½äºæ­¤ç†µå€¼çš„å—è¿›å…¥ RAG
- **`rag`**: 
    - `embedding_model`: Sentence Transformer æ¨¡å‹åç§° (e.g., "all-MiniLM-L6-v2")
    - `top_k`: æ£€ç´¢æ—¶è¿”å›çš„ç›¸å…³æ–‡æœ¬å—æ•°é‡
- **`mcp_candidates`**: MCP å€™é€‰æ–¹æ¡ˆæ•°é‡ (1 è¡¨ç¤ºç¦ç”¨)

ç¤ºä¾‹ (`config.json`):
```json
{
    "llm": {
        "type": "local",
        "model_path": "gpt2", // Or your local model path
        "device": "auto",
        "context_length": 1024
    },
    "processor": {
        "batch_size": 256,
        "entropy_threshold": 2.8
    },
    "rag": {
        "embedding_model": "all-MiniLM-L6-v2",
        "top_k": 5
    },
    "mcp_candidates": 3 // Enable MCP with 3 candidates
}
```

## ğŸŒ OpenAI å…¼å®¹ API æœåŠ¡å™¨

OpenKimi æä¾›äº†ä¸€ä¸ª FastAPI æœåŠ¡å™¨ï¼Œç”¨äºæš´éœ² OpenAI Chat Completion å…¼å®¹çš„ API ç«¯ç‚¹ã€‚

**å¯åŠ¨æœåŠ¡å™¨:**

```bash
# Make sure dependencies are installed: pip install -r requirements.txt

# Set API Key if using API backend for the engine itself
# export OPENAI_API_KEY="sk-..."

python -m openkimi.api.server --config examples/config.json --port 8000 --host 0.0.0.0
```

**å¯ç”¨å‚æ•°:**
- `--host`: ç›‘å¬åœ°å€ (é»˜è®¤: 127.0.0.1)
- `--port`: ç›‘å¬ç«¯å£ (é»˜è®¤: 8000)
- `--config` / `-c`: KimiEngine é…ç½®æ–‡ä»¶è·¯å¾„
- `--mcp-candidates`: è¦†ç›–é…ç½®ä¸­çš„ MCP å€™é€‰æ•°é‡
- `--reload`: å¼€å‘æ¨¡å¼ï¼Œä»£ç æ›´æ”¹æ—¶è‡ªåŠ¨é‡è½½

**API ç«¯ç‚¹:**
- `POST /v1/chat/completions`: å¤„ç†èŠå¤©è¯·æ±‚ã€‚
- `GET /health`: æ£€æŸ¥æœåŠ¡å™¨å’Œå¼•æ“çŠ¶æ€ã€‚

**ä½¿ç”¨ç¤ºä¾‹ (curl):**

```bash
curl http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openkimi-model", 
    "messages": [
      {"role": "system", "content": "è¿™æ˜¯éœ€è¦å¤„ç†çš„é•¿æ–‡æ¡£å†…å®¹..."},
      {"role": "user", "content": "è¯·æ ¹æ®æ–‡æ¡£å›ç­”è¿™ä¸ªé—®é¢˜ï¼Ÿ"}
    ]
  }'
```

> [!WARNING]
> æœ¬é¡¹ç›®ä¸æ˜¯ Starlight Dream çš„ç»´æŠ¤é¡¹ç›®ï¼Œä¸ Starlight Dream æ— ä»»ä½•å…³ç³»ï¼Œå¹¶ä¸”ä¸ä¿éšœç¨³å®šçš„ç»´æŠ¤ã€‚
